<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Change password</title>
    <style>
      body{font-family:Segoe UI,Roboto,Arial;margin:0;display:flex;align-items:center;justify-content:center;height:100vh;background:#f5f7fb}
      .card{background:#fff;padding:22px;border-radius:10px;box-shadow:0 6px 20px rgba(2,6,23,0.06);width:100%;max-width:480px}
      label{display:block;margin-bottom:6px;font-size:13px}
      input{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef;font-size:14px}
      .row{display:flex;gap:8px;align-items:center;margin-top:12px}
      button.primary{background:#2563eb;color:#fff;border:0;padding:10px 14px;border-radius:8px;cursor:pointer}
      .muted{color:#6b7280;font-size:13px}
      .error{color:#b91c1c;font-size:13px;margin-top:8px}
    </style>
  </head>
  <body>
    <main class="card">
      <h2>Change password</h2>
      <p id="note" class="muted">Enter your current password and choose a new password.</p>

      <form id="changeForm">
        <div id="currentWrap" style="margin-top:12px">
          <label for="current">Current password</label>
          <input id="current" type="password" autocomplete="current-password" />
        </div>

        <div style="margin-top:12px">
          <label for="newpw">New password</label>
          <input id="newpw" type="password" autocomplete="new-password" />
        </div>

        <div style="margin-top:12px">
          <label for="confirm">Confirm new password</label>
          <input id="confirm" type="password" autocomplete="new-password" />
        </div>

        <div id="err" class="error" style="display:none"></div>

        <div class="row" style="justify-content:space-between">
          <a href="index.html" class="muted">Cancel</a>
          <div>
            <button type="submit" class="primary">Change password</button>
          </div>
        </div>
      </form>
    </main>

    <script>
      // Client-side simulated password change.
      const verifiedVia = localStorage.getItem('verified_via');
      const note = document.getElementById('note');
      const currentWrap = document.getElementById('currentWrap');
      const changeForm = document.getElementById('changeForm');
      const err = document.getElementById('err');

      // If user came from forgot flow, we allow changing without current password
      if (verifiedVia === 'otp' || verifiedVia === 'email'){
        note.textContent = 'Verified via ' + verifiedVia + ' â€” choose a new password.';
        // hide current password field
        currentWrap.style.display = 'none';
      }

      changeForm.addEventListener('submit', (e)=>{
        e.preventDefault();
        err.style.display='none';
        const current = document.getElementById('current').value;
        const newpw = document.getElementById('newpw').value;
        const confirm = document.getElementById('confirm').value;

        if (!newpw || !confirm){ err.textContent='Please fill the new password fields.'; err.style.display='block'; return; }
        if (newpw !== confirm){ err.textContent='New passwords do not match.'; err.style.display='block'; return; }
        if (newpw.length < 6){ err.textContent='New password must be at least 6 characters.'; err.style.display='block'; return; }

        if (!verifiedVia){
          // require current password on normal change (simulate: demo current password is 'demo')
          if (current !== 'demo'){ err.textContent='Current password is incorrect (demo expects "demo").'; err.style.display='block'; return; }
        }

        // Simulate saving new password
        // In real app, POST to backend and handle success/fail
        localStorage.removeItem('verified_via');
        localStorage.removeItem('verified_email');
        localStorage.removeItem('reset_token');
        alert('Password changed successfully (simulated). You can now sign in.');
        window.location.href = 'index.html';
      });
    </script>
  </body>
</html>
